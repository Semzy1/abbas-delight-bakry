<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abba's Delight - Simple Backend Simulation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
        }
        .font-display {
            font-family: 'Playfair Display', serif;
        }
        .hero-bg {
            background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://images.unsplash.com/photo-1509440159596-0249088772ff?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1472&q=80');
            background-size: cover;
            background-position: center;
        }
        .logo {
            width: 60px;
            height: 60px;
            background: #F59E0B;
            color: #000;
            font-weight: 700;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
        }
        .logo::before {
            content: "";
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 20px;
            background: #F59E0B;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        }
        .mobile-menu {
            transition: transform 0.3s ease-in-out;
        }
        .menu-open {
            transform: translateX(0);
        }
        .menu-closed {
            transform: translateX(100%);
        }
        .cart-item {
            transition: all 0.3s ease;
        }
        .cart-item-remove {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .cart-item:hover .cart-item-remove {
            opacity: 1;
        }
        .order-summary-item {
            border-bottom: 1px solid #FDE68A;
            padding-bottom: 0.75rem;
            margin-bottom: 0.75rem;
        }
        .order-summary-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
        }
        .vendor-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }
        .vendor-panel.open {
            right: 0;
        }
        .vendor-toggle {
            position: fixed;
            top: 50%;
            right: 0;
            transform: translateY(-50%) rotate(-90deg);
            transform-origin: right top;
            background: #F59E0B;
            color: black;
            padding: 10px 15px;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
            z-index: 999;
            font-weight: bold;
        }
        .order-status-new { background-color: #FEF3C7; color: #D97706; }
        .order-status-preparing { background-color: #DBEAFE; color: #1D4ED8; }
        .order-status-ready { background-color: #D1FAE5; color: #065F46; }
        .order-status-completed { background-color: #E5E7EB; color: #374151; }
        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #EF4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        .message-template {
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .message-template:hover {
            background-color: #FEF3C7;
            border-color: #F59E0B;
        }
        .message-template.active {
            background-color: #FEF3C7;
            border-color: #F59E0B;
        }
        .customer-message {
            background-color: #F0F9FF;
            border-left: 4px solid #0EA5E9;
            padding: 12px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .backend-status {
            position: fixed;
            top: 10px;
            left: 10px;
            background: #dc3545;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 1001;
        }
        .backend-status.connected {
            background: #28a745;
        }

        /* Menu option styling */
        .option-row {
            padding: 0.45rem 0;
            border-bottom: 1px dashed rgba(245, 158, 11, 0.06);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
        }
        .option-row:last-child {
            border-bottom: none;
        }
        .option-left { display: flex; align-items: center; gap: 0.75rem; }
        .option-label { font-weight: 600; color: #374151; }
        .price-badge {
            background: #FEF3C7; /* pale amber */
            color: #000 !important; /* force black for price text */
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-weight: 700;
            box-shadow: 0 1px 0 rgba(0,0,0,0.02);
            display: inline-block;
            min-width: 48px;
            text-align: center;
        }
        .add-to-cart {
            transition: transform 0.12s ease, box-shadow 0.12s ease, opacity 0.12s ease;
        }
        .add-to-cart:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(0,0,0,0.08);
        }
    </style>
</head>
<body class="bg-amber-50">
    <!-- Backend Status Indicator -->
    <div class="backend-status" id="backend-status">
        ⚠️ Backend Not Connected - Using Local Storage
    </div>

    <!-- Vendor Panel Toggle -->
    <div class="vendor-toggle" id="vendor-toggle">
        Vendor Panel
    </div>

    <!-- Vendor Panel -->
    <div class="vendor-panel" id="vendor-panel">
        <div class="p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="font-display text-2xl font-bold">Vendor Dashboard</h2>
                <button id="close-vendor-panel" class="text-gray-500 hover:text-gray-700">
                    <i data-feather="x" class="w-5 h-5"></i>
                </button>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-amber-100 p-4 rounded-lg text-center">
                    <p class="text-sm text-gray-600">Today's Orders</p>
                    <p class="text-2xl font-bold" id="vendor-today-orders">0</p>
                </div>
                <div class="bg-amber-100 p-4 rounded-lg text-center">
                    <p class="text-sm text-gray-600">Pending</p>
                    <p class="text-2xl font-bold" id="vendor-pending-orders">0</p>
                </div>
            </div>

            <!-- Orders List -->
            <h3 class="font-bold mb-3">Recent Orders</h3>
            <div id="vendor-orders-list" class="space-y-4 mb-6 max-h-64 overflow-y-auto">
                <!-- Orders will be populated here -->
                <p class="text-center text-gray-500 py-4">No orders yet</p>
            </div>

            <!-- Order Details -->
            <div id="vendor-order-details" class="hidden">
                <h3 class="font-bold mb-3">Order Details</h3>
                <div id="vendor-order-content" class="bg-amber-50 p-4 rounded-lg mb-4">
                    <!-- Order details will be populated here -->
                </div>
                <div class="flex space-x-2 mb-4">
                    <select id="vendor-order-status" class="flex-grow p-2 border rounded">
                        <option value="new">New</option>
                        <option value="preparing">Preparing</option>
                        <option value="ready">Ready</option>
                        <option value="completed">Completed</option>
                    </select>
                    <button id="vendor-update-status" class="bg-amber-500 hover:bg-amber-600 text-black font-bold py-2 px-4 rounded">
                        Update
                    </button>
                </div>
                
                <!-- Customer Communication -->
                <div class="border-t pt-4 mt-4">
                    <h3 class="font-bold mb-3">Contact Customer</h3>
                    
                    <!-- Quick Message Templates -->
                    <div class="mb-4">
                        <p class="text-sm text-gray-600 mb-2">Quick Messages:</p>
                        <div class="space-y-2">
                            <div class="message-template" data-template="order-confirmed">
                                <p class="font-medium">Order Confirmation</p>
                                <p class="text-sm text-gray-600">Hi [Customer], your order #[OrderID] has been confirmed.</p>
                            </div>
                            <div class="message-template" data-template="order-ready">
                                <p class="font-medium">Order Ready</p>
                                <p class="text-sm text-gray-600">Hi [Customer], your order #[OrderID] is ready for pickup/delivery.</p>
                            </div>
                            <div class="message-template" data-template="delivery-update">
                                <p class="font-medium">Delivery Update</p>
                                <p class="text-sm text-gray-600">Hi [Customer], your order #[OrderID] is on its way.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Custom Message -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Custom Message:</label>
                        <textarea id="vendor-custom-message" rows="3" class="w-full p-2 border rounded" placeholder="Type your message to the customer..."></textarea>
                    </div>
                    
                    <!-- Communication Options -->
                    <div class="flex space-x-2">
                        <button id="vendor-send-email" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded flex items-center justify-center">
                            <i data-feather="mail" class="w-4 h-4 mr-2"></i> Email
                        </button>
                        <button id="vendor-send-whatsapp" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded flex items-center justify-center">
                            <i data-feather="message-circle" class="w-4 h-4 mr-2"></i> WhatsApp
                        </button>
                    </div>
                    
                    <!-- Message History -->
                    <div class="mt-6">
                        <h4 class="font-bold mb-2">Message History</h4>
                        <div id="vendor-message-history" class="max-h-40 overflow-y-auto">
                            <!-- Message history will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Backend Setup Instructions -->
            <div class="mt-6 pt-6 border-t">
                <h3 class="font-bold mb-3">Backend Setup</h3>
                <div class="bg-blue-50 p-4 rounded-lg">
                    <p class="text-sm text-blue-800 mb-2">
                        <strong>To enable full backend functionality:</strong>
                    </p>
                    <ol class="text-sm text-blue-700 list-decimal list-inside space-y-1">
                        <li>Install Node.js from <a href="https://nodejs.org" target="_blank" class="underline">nodejs.org</a></li>
                        <li>Run <code class="bg-blue-200 px-1 rounded">npm install</code> in this folder</li>
                        <li>Run <code class="bg-blue-200 px-1 rounded">node server.js</code> to start backend</li>
                        <li>Refresh this page</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="bg-black text-amber-50 p-4 sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="logo">AD</div>
                <span class="font-display text-2xl font-bold">Abba's Delight</span>
            </div>
            
            <div class="hidden md:flex space-x-8">
                <a href="#" class="hover:text-amber-300">Home</a>
                <a href="#about" class="hover:text-amber-300">About</a>
                <a href="#menu" class="hover:text-amber-300">Menu</a>
                <a href="#specialties" class="hover:text-amber-300">Specialties</a>
                <a href="#contact" class="hover:text-amber-300">Contact</a>
            </div>
            
            <div class="flex items-center space-x-4">
                <a href="#order" class="bg-amber-500 hover:bg-amber-600 text-black font-bold py-2 px-6 rounded-full transition hidden md:block">
                    Order Now <i data-feather="shopping-cart" class="inline ml-1"></i>
                </a>
                
                <button id="mobile-menu-button" class="md:hidden text-amber-50">
                    <i data-feather="menu" class="w-6 h-6"></i>
                </button>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="mobile-menu menu-closed fixed top-0 right-0 h-full w-64 bg-black p-6 z-50 md:hidden">
            <div class="flex justify-between items-center mb-8">
                <div class="flex items-center space-x-2">
                    <div class="logo">AD</div>
                    <span class="font-display text-xl font-bold">Abba's Delight</span>
                </div>
                <button id="close-menu" class="text-amber-50">
                    <i data-feather="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <div class="space-y-6">
                <a href="#" class="block hover:text-amber-300 text-lg">Home</a>
                <a href="#about" class="block hover:text-amber-300 text-lg">About</a>
                <a href="#menu" class="block hover:text-amber-300 text-lg">Menu</a>
                <a href="#specialties" class="block hover:text-amber-300 text-lg">Specialties</a>
                <a href="#contact" class="block hover:text-amber-300 text-lg">Contact</a>
                <a href="#order" class="block bg-amber-500 hover:bg-amber-600 text-black font-bold py-2 px-6 rounded-full transition text-center mt-8">
                    Order Now <i data-feather="shopping-cart" class="inline ml-1"></i>
                </a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-bg h-screen flex items-center justify-center text-amber-50 px-4">
        <div class="text-center max-w-4xl" data-aos="fade-up">
            <h1 class="font-display text-5xl md:text-7xl font-bold mb-4">Where every bite is a delight</h1>
            <p class="text-xl mb-8">Premium bakery goods delivered fresh to your door</p>
            <div class="flex flex-col md:flex-row justify-center gap-4">
                <a href="#menu" class="bg-amber-500 hover:bg-amber-600 text-black font-bold py-3 px-8 text-lg rounded-full transition">
                    View Menu
                </a>
                <a href="#order" class="border border-amber-300 hover:bg-black hover:border-black text-amber-300 font-bold py-3 px-8 text-lg rounded-full transition">
                    Order Now
                </a>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="py-20 px-4 bg-white">
        <div class="container mx-auto max-w-6xl">
            <div class="text-center mb-16" data-aos="fade-up">
                <h2 class="font-display text-4xl font-bold mb-4">Our Story</h2>
                <div class="w-24 h-1 bg-amber-500 mx-auto"></div>
            </div>
            <div class="flex flex-col md:flex-row items-center gap-12">
                <div class="md:w-1/2" data-aos="fade-right">
                    <img src="https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1074&q=80" alt="Bakery kitchen" class="rounded-lg shadow-xl w-full h-auto">
                </div>
                <div class="md:w-1/2" data-aos="fade-left">
                    <h3 class="font-display text-2xl font-bold mb-4">Family Tradition Since 2023</h3>
                    <p class="mb-6">Abba's Delight was created to bring the unique and beloved taste of Nigerian pastries to a new home. Our mission is to introduce and share the rich flavors of Nigerian baked goods with a discerning clientele, using traditional recipes and the finest ingredients.</p>
                    <p class="mb-6">We craft delicious, high-quality baked goods that honor traditional Nigerian recipes to ensure every bite delivers the authentic taste and warmth you deserve, bringing a taste of Nigeria directly to your door.</p>
                    <div class="space-y-4">
                        <div class="flex items-start">
                            <i data-feather="check-circle" class="text-amber-500 mr-3 mt-1"></i>
                            <span class="font-medium">Freshly made with premium ingredients</span>
                        </div>
                        <div class="flex items-start">
                            <i data-feather="check-circle" class="text-amber-500 mr-3 mt-1"></i>
                            <span class="font-medium">Authentic Nigerian recipes and flavors</span>
                        </div>
                        <div class="flex items-start">
                            <i data-feather="check-circle" class="text-amber-500 mr-3 mt-1"></i>
                            <span class="font-medium">Hygienically prepared</span>
                        </div>
                        <div class="flex items-start">
                            <i data-feather="check-circle" class="text-amber-500 mr-3 mt-1"></i>
                            <span class="font-medium">Delivery to your door</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Menu Section -->
<section id="menu" class="py-20 px-4 bg-amber-50">
  <div class="container mx-auto max-w-6xl">
    <div class="text-center mb-16" data-aos="fade-up">
      <h2 class="font-display text-4xl font-bold mb-4">Our Menu</h2>
      <div class="w-24 h-1 bg-amber-500 mx-auto"></div>
      <p class="mt-6">Prices shown include single and pack options</p>
    </div>

    <div class="grid md:grid-cols-2 gap-12">
      <!-- Savory Items -->
      <div class="bg-white p-8 rounded-lg shadow-xl" data-aos="fade-right">
        <h3 class="font-display text-2xl font-bold mb-6 text-center border-b-2 border-amber-500 pb-3">
          Savory Delights
        </h3>
        <div class="space-y-6">

          <!-- Meat Pie -->
          <div class="flex justify-between items-center cart-item" data-id="1" data-name="Meat Pie" data-price="3">
            <div>
              <h4 class="font-bold">Meat Pie</h4>
              <p class="text-gray-600 text-sm">Flaky pastry with spiced minced meat</p>
            </div>
            <div class="flex flex-col space-y-1 text-right">
                    <div class="option-row flex items-center justify-between" data-option-price="3" data-option-qty="1">
                        <div class="flex items-center space-x-3">
                            <span class="text-sm text-gray-600">1 pc</span>
                            <span class="price-badge px-2 py-1 bg-amber-100 text-amber-800 rounded font-bold">3₽</span>
                        </div>
                        <button class="add-to-cart bg-amber-500 hover:bg-amber-600 text-black font-bold py-1 px-3 rounded-full text-sm transition">Add</button>
                    </div>
                    <div class="option-row flex items-center justify-between" data-option-price="11" data-option-qty="4">
                        <div class="flex items-center space-x-3">
                            <span class="text-sm text-gray-600">4 pcs</span>
                            <span class="price-badge px-2 py-1 bg-amber-100 text-amber-800 rounded font-bold">11₽</span>
                        </div>
                        <button class="add-to-cart bg-amber-500 hover:bg-amber-600 text-black font-bold py-1 px-3 rounded-full text-sm transition">Add</button>
                    </div>
            </div>
          </div>

          <!-- Sausage Roll -->
          <div class="flex justify-between items-center cart-item" data-id="2" data-name="Sausage Roll" data-price="2.30">
            <div>
              <h4 class="font-bold">Sausage Roll</h4>
              <p class="text-gray-600 text-sm">Premium sausage wrapped in puff pastry</p>
            </div>
            <div class="flex flex-col space-y-1 text-right">
                    <div class="option-row flex items-center justify-between" data-option-price="3" data-option-qty="4">
                        <div class="flex items-center space-x-3">
                            <span class="text-sm text-gray-600">5 pcs</span>
                            <span class="price-badge px-2 py-1 bg-amber-100 text-amber-800 rounded font-bold">3₽</span>
                        </div>
                        <button class="add-to-cart bg-amber-500 hover:bg-amber-600 text-black font-bold py-1 px-3 rounded-full text-sm transition">Add</button>
                    </div>
            </div>
          </div>

          <!-- Chicken Pie -->
          <div class="flex justify-between items-center cart-item" data-id="3" data-name="Chicken Pie" data-price="2.80">
            <div>
              <h4 class="font-bold">Chicken Pie</h4>
              <p class="text-gray-600 text-sm">Tender chicken pieces in rich pastry</p>
            </div>
            <div class="flex flex-col space-y-1 text-right">
                    <div class="option-row flex items-center justify-between" data-option-price="3" data-option-qty="1">
                        <div class="flex items-center space-x-3">
                            <span class="text-sm text-gray-600">1 pc</span>
                            <span class="price-badge px-2 py-1 bg-amber-100 text-amber-800 rounded font-bold">3₽</span>
                        </div>
                        <button class="add-to-cart bg-amber-500 hover:bg-amber-600 text-black font-bold py-1 px-3 rounded-full text-sm transition">Add</button>
                    </div>
                    <div class="option-row flex items-center justify-between" data-option-price="11" data-option-qty="4">
                        <div class="flex items-center space-x-3">
                            <span class="text-sm text-gray-600">4 pcs</span>
                            <span class="price-badge px-2 py-1 bg-amber-100 text-amber-800 rounded font-bold">11₽</span>
                        </div>
                        <button class="add-to-cart bg-amber-500 hover:bg-amber-600 text-black font-bold py-1 px-3 rounded-full text-sm transition">Add</button>
                    </div>
            </div>
          </div>

          <!-- Fish Roll -->
          <div class="flex justify-between items-center cart-item" data-id="4" data-name="Fish Roll" data-price="2.40">
            <div>
              <h4 class="font-bold">Fish Roll</h4>
              <p class="text-gray-600 text-sm">Seasoned fish in golden dough</p>
            </div>
            <div class="flex flex-col space-y-1 text-right">
                    <div class="option-row flex items-center justify-between" data-option-price="3" data-option-qty="1">
                        <div class="flex items-center space-x-3">
                            <span class="text-sm text-gray-600">1 pc</span>
                            <span class="price-badge px-2 py-1 bg-amber-100 text-amber-800 rounded font-bold">3₽</span>
                        </div>
                        <button class="add-to-cart bg-amber-500 hover:bg-amber-600 text-black font-bold py-1 px-3 rounded-full text-sm transition">Add</button>
                    </div>
                    <div class="option-row flex items-center justify-between" data-option-price="5" data-option-qty="4">
                        <div class="flex items-center space-x-3">
                            <span class="text-sm text-gray-600">2 pcs</span>
                            <span class="price-badge px-2 py-1 bg-amber-100 text-amber-800 rounded font-bold">5₽</span>
                        </div>
                        <button class="add-to-cart bg-amber-500 hover:bg-amber-600 text-black font-bold py-1 px-3 rounded-full text-sm transition">Add</button>
                    </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sweet Items -->
      <div class="bg-white p-8 rounded-lg shadow-xl" data-aos="fade-left">
        <h3 class="font-display text-2xl font-bold mb-6 text-center border-b-2 border-amber-500 pb-3">
          Sweet Treats
        </h3>
        <div class="space-y-6">

          <!-- Puff Puff -->
          <div class="flex justify-between items-center cart-item" data-id="5" data-name="Puff-Puff" data-price="1.50">
            <div>
              <h4 class="font-bold">Puff-Puff</h4>
              <p class="text-gray-600 text-sm">Classic African doughnut balls</p>
            </div>
            <div class="flex flex-col space-y-1 text-right">
                        <div class="option-row flex items-center justify-between" data-option-price="4" data-option-qty="1">
                            <div class="flex items-center space-x-3">
                                <span class="text-sm text-gray-600">5 pcs</span>
                                <span class="price-badge px-2 py-1 bg-amber-100 text-amber-800 rounded font-bold">4₽</span>
                            </div>
                            <button class="add-to-cart bg-amber-500 hover:bg-amber-600 text-black font-bold py-1 px-3 rounded-full text-sm transition">Add</button>
                        </div>
                    <div class="option-row flex items-center justify-between" data-option-price="7" data-option-qty="10">
                        <div class="flex items-center space-x-3">
                            <span class="text-sm text-gray-600">10 pcs</span>
                            <span class="price-badge px-2 py-1 bg-amber-100 text-amber-800 rounded font-bold">7₽</span>
                        </div>
                        <button class="add-to-cart bg-amber-500 hover:bg-amber-600 text-black font-bold py-1 px-3 rounded-full text-sm transition">Add</button>
                    </div>
            </div>
          </div>

          <!-- Chin Chin -->
          <div class="flex justify-between items-center cart-item" data-id="6" data-name="Chin-Chin" data-price="5">
            <div>
              <h4 class="font-bold">Chin-Chin</h4>
              <p class="text-gray-600 text-sm">Crunchy fried pastry bites</p>
            </div>
            <div class="flex flex-col space-y-1 text-right">
                        <div class="option-row flex items-center justify-between" data-option-price="5" data-option-qty="1pack">
                            <div class="flex items-center space-x-3">
                                <span class="text-sm text-gray-600">1 pack</span>
                                <span class="price-badge px-2 py-1 bg-amber-100 text-amber-800 rounded font-bold">5₽</span>
                            </div>
                            <button class="add-to-cart bg-amber-500 hover:bg-amber-600 text-black font-bold py-1 px-3 rounded-full text-sm transition">Add</button>
                        </div>
            </div>
          </div>

          <!-- Mini Donuts -->
          <div class="flex justify-between items-center cart-item" data-id="7" data-name="Mini Donuts" data-price="8.00">
            <div>
              <h4 class="font-bold">Mini Donuts</h4>
              <p class="text-gray-600 text-sm">Assorted glazed donuts</p>
            </div>
            <div class="flex flex-col space-y-1 text-right">
                        <div class="option-row flex items-center justify-between" data-option-price="8" data-option-qty="6">
                            <div class="flex items-center space-x-3">
                                <span class="text-sm text-gray-600">6 pcs</span>
                                <span class="price-badge px-2 py-1 bg-amber-100 text-amber-800 rounded font-bold">8₽</span>
                            </div>
                            <button class="add-to-cart bg-amber-500 hover:bg-amber-600 text-black font-bold py-1 px-3 rounded-full text-sm transition">Add</button>
                        </div>
                    <div class="option-row flex items-center justify-between" data-option-price="14" data-option-qty="12">
                        <div class="flex items-center space-x-3">
                            <span class="text-sm text-gray-600">12 pcs</span>
                            <span class="price-badge px-2 py-1 bg-amber-100 text-amber-800 rounded font-bold">14₽</span>
                        </div>
                        <button class="add-to-cart bg-amber-500 hover:bg-amber-600 text-black font-bold py-1 px-3 rounded-full text-sm transition">Add</button>
                    </div>
            </div>
          </div>

          <!-- Custard Tart -->
          <div class="flex justify-between items-center cart-item" data-id="8" data-name="Custard Tart" data-price="3.00">
            <div>
              <h4 class="font-bold">Custard Tart</h4>
              <p class="text-gray-600 text-sm">Crème-filled pastry with nutmeg</p>
            </div>
            <div class="flex flex-col space-y-1 text-right">
                        <div class="option-row flex items-center justify-between" data-option-price="3" data-option-qty="1">
                            <div class="flex items-center space-x-3">
                                <span class="text-sm text-gray-600">1 pc</span>
                                <span class="price-badge px-2 py-1 bg-amber-100 text-amber-800 rounded font-bold">3₽</span>
                            </div>
                            <button class="add-to-cart bg-amber-500 hover:bg-amber-600 text-black font-bold py-1 px-3 rounded-full text-sm transition">Add</button>
                        </div>
                    <div class="option-row flex items-center justify-between" data-option-price="10" data-option-qty="4">
                        <div class="flex items-center space-x-3">
                            <span class="text-sm text-gray-600">4 pcs</span>
                            <span class="price-badge px-2 py-1 bg-amber-100 text-amber-800 rounded font-bold">10₽</span>
                        </div>
                        <button class="add-to-cart bg-amber-500 hover:bg-amber-600 text-black font-bold py-1 px-3 rounded-full text-sm transition">Add</button>
                    </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <div class="mt-16 text-center" data-aos="fade-up">
      <a href="#order"
        class="bg-amber-500 hover:bg-amber-600 text-black font-bold py-3 px-8 text-lg rounded-full transition inline-block">
        Order Your Favorites
      </a>
    </div>
  </div>
</section>


    <!-- Specialties Section -->
    <section id="specialties" class="py-20 px-4 bg-white">
        <div class="container mx-auto max-w-6xl">
            <div class="text-center mb-16" data-aos="fade-up">
                <h2 class="font-display text-4xl font-bold mb-4">Our Specialties</h2>
                <div class="w-24 h-1 bg-amber-500 mx-auto"></div>
                <p class="mt-6">Perfect for your special occasions and events</p>
            </div>
            
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="bg-amber-50 p-8 rounded-lg shadow-lg hover:shadow-xl transition" data-aos="fade-up" data-aos-delay="0">
                    <div class="text-amber-600 mb-4">
                        <i data-feather="cake" class="w-12 h-12"></i>
                    </div>
                    <h3 class="font-display text-2xl font-bold mb-3">Wedding Cakes</h3>
                    <p class="mb-4">Exquisite designs to make your special day unforgettable. Custom flavors and decorations available.</p>
                    <a href="#contact" class="text-amber-600 font-semibold hover:underline">Inquire Now</a>
                </div>
                
                <div class="bg-amber-50 p-8 rounded-lg shadow-lg hover:shadow-xl transition" data-aos="fade-up" data-aos-delay="100">
                    <div class="text-amber-600 mb-4">
                        <i data-feather="gift" class="w-12 h-12"></i>
                    </div>
                    <h3 class="font-display text-2xl font-bold mb-3">Birthday Cakes</h3>
                    <p class="mb-4">Celebrate in style with our creative cake designs. From classic to custom themed creations.</p>
                    <a href="#contact" class="text-amber-600 font-semibold hover:underline">Inquire Now</a>
                </div>
                
                <div class="bg-amber-50 p-8 rounded-lg shadow-lg hover:shadow-xl transition" data-aos="fade-up" data-aos-delay="200">
                    <div class="text-amber-600 mb-4">
                        <i data-feather="users" class="w-12 h-12"></i>
                    </div>
                    <h3 class="font-display text-2xl font-bold mb-3">Event Catering</h3>
                    <p class="mb-4">Complete dessert and pastry catering for corporate events, parties, and gatherings of all sizes.</p>
                    <a href="#contact" class="text-amber-600 font-semibold hover:underline">Inquire Now</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Order Section -->
    <section id="order" class="py-20 px-4 bg-amber-500">
        <div class="container mx-auto max-w-6xl">
            <div class="text-center mb-16" data-aos="fade-up">
                <h2 class="font-display text-4xl font-bold mb-4 text-white">Order Online</h2>
                <div class="w-24 h-1 bg-black mx-auto"></div>
                <p class="mt-6 text-amber-900 font-medium">Freshly baked & delivered to your door</p>
            </div>
            
            <div class="bg-white rounded-lg shadow-xl p-8 max-w-4xl mx-auto" data-aos="fade-up">
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="font-display text-2xl font-bold mb-6">Delivery Information</h3>
                        <form id="order-form" class="space-y-4">
                            <div>
                                <label class="block text-gray-700 mb-1">Full Name *</label>
                                <input type="text" id="customer-name" required class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-1">Phone Number *</label>
                                <input type="tel" id="customer-phone" required class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-1">Email Address *</label>
                                <input type="email" id="customer-email" required class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-1">Delivery Address *</label>
                                <textarea id="customer-address" required class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500"></textarea>
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-1">Delivery Date & Time *</label>
                                <input type="datetime-local" id="delivery-time" required class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-1">Allergy</label>
                                <textarea id="special-instructions" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500"></textarea>
                            </div>
                        </form>
                    </div>
                    
                    <div>
                        <h3 class="font-display text-2xl font-bold mb-6">Your Order</h3>
                        <div class="bg-amber-50 rounded-lg p-6 mb-6">
                            <div id="order-summary" class="space-y-4 mb-6">
                                <p class="text-center text-gray-500 py-4">Your cart is empty</p>
                            </div>
                            <div class="border-t border-amber-200 pt-4">
                                <div class="flex justify-between font-bold">
                                    <p>Total</p>
                                    <p id="order-total">0.00₽</p>
                                </div>
                            </div>
                        </div>
                        
                        <button id="complete-order" class="w-full bg-black hover:bg-gray-800 text-white font-bold py-3 px-4 rounded-lg transition opacity-50 cursor-not-allowed" disabled>
                            Complete Order <i data-feather="arrow-right" class="inline ml-2"></i>
                        </button>
                        
                        <p class="mt-6 text-sm text-gray-600">We'll contact you to confirm your order details and payment method.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="py-20 px-4 bg-white">
        <div class="container mx-auto max-w-6xl">
            <div class="flex flex-col md:flex-row gap-12">
                <div class="md:w-1/2" data-aos="fade-right">
                    <div class="text-center mb-12 md:text-left">
                        <h2 class="font-display text-4xl font-bold mb-4">Get In Touch</h2>
                        <div class="w-24 h-1 bg-amber-500 md:mx-0 mx-auto"></div>
                        <p class="mt-6">Have questions or want to place a large order? Contact us!</p>
                    </div>
                    
                    <div class="space-y-6">
                        <div class="flex items-start">
                            <i data-feather="phone" class="text-amber-500 mr-4 mt-1"></i>
                            <div>
                                <h4 class="font-bold">Phone</h4>
                                <p>+375 255 266 598</p>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <i data-feather="mail" class="text-amber-500 mr-4 mt-1"></i>
                            <div>
                                <h4 class="font-bold">Email</h4>
                                <p>0xhephzibah@gmail.com</p>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <i data-feather="instagram" class="text-amber-500 mr-4 mt-1"></i>
                            <div>
                                <h4 class="font-bold">Instagram</h4>
                                <p>@abbas_delightttt</p>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <i data-feather="clock" class="text-amber-500 mr-4 mt-1"></i>
                            <div>
                                <h4 class="font-bold">Order Hours</h4>
                                <p>Monday - Friday: 8am - 7pm<br>Saturday: 9am - 4pm</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8">
                        <h4 class="font-bold mb-4">Follow Us</h4>
                        <div class="flex space-x-4">
                            <a href="#" class="bg-black text-white p-3 rounded-full hover:bg-gray-800 transition">
                                <i data-feather="facebook"></i>
                            </a>
                            <a href="https://www.instagram.com/abbas_delightttt" target="_blank"
                                class="bg-black text-white p-3 rounded-full hover:bg-gray-800 transition">
                                <i data-feather="instagram"></i>
                            </a>
                            <a href="#" class="bg-black text-white p-3 rounded-full hover:bg-gray-800 transition">
                                <i data-feather="twitter"></i>
                            </a>
                            <!-- WhatsApp: use full international number without '+' or spaces. Add rel for security and aria-label for accessibility. 
                                 Optionally include a prefilled message via the `text` query param. -->
                            <a href="https://wa.me/375255266598?text=Hello%20I%27d%20like%20to%20place%20an%20order" target="_blank" rel="noopener noreferrer" aria-label="Contact Abba's Delight on WhatsApp" class="bg-green-600 text-white p-3 rounded-full hover:bg-green-700 transition">
                                <i data-feather="message-circle"></i>
                            </a>
                        </div>
                    </div>
                </div>
                
                <div class="md:w-1/2" data-aos="fade-left">
                    <div class="bg-amber-50 rounded-lg p-8">
                        <h3 class="font-display text-2xl font-bold mb-6">Send Us a Message</h3>
                        <form class="space-y-4">
                            <div>
                                <label class="block text-gray-700 mb-1">Your Name</label>
                                <input type="text" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-1">Email Address</label>
                                <input type="email" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-1">Subject</label>
                                <input type="text" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-1">Message</label>
                                <textarea rows="4" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500"></textarea>
                            </div>
                            <button type="submit" class="bg-black hover:bg-gray-800 text-white font-bold py-3 px-6 rounded transition">
                                Send Message
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Order Confirmation Modal -->
    <div id="order-confirmation" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-8 rounded-lg max-w-md text-center">
            <i data-feather="check-circle" class="w-16 h-16 text-green-500 mx-auto mb-4"></i>
            <h3 class="font-display text-2xl font-bold mb-2">Order Confirmed!</h3>
            <p class="mb-4">Thank you for your order. We'll contact you shortly to confirm details.</p>
            <p class="text-sm text-gray-600 mb-6">Order ID: <span id="confirmed-order-id"></span></p>
            <div class="flex justify-center items-center gap-3">
                <a id="send-order-whatsapp" href="#" target="_blank" rel="noopener noreferrer" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full transition">
                    <i data-feather="message-circle" class="inline mr-2"></i> Send via WhatsApp
                </a>
                <button id="close-confirmation" class="bg-amber-500 hover:bg-amber-600 text-black font-bold py-2 px-6 rounded-full transition">
                    Continue Shopping
                </button>
            </div>
        </div>
    </div>

    <script>
        // Initialize AOS and Feather Icons
        document.addEventListener('DOMContentLoaded', function() {
            AOS.init();
            feather.replace();
            
            // Check backend connection
            checkBackendConnection();
            
            // Mobile menu functionality
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const closeMenuButton = document.getElementById('close-menu');
            const mobileMenu = document.getElementById('mobile-menu');
            
            mobileMenuButton.addEventListener('click', function() {
                mobileMenu.classList.remove('menu-closed');
                mobileMenu.classList.add('menu-open');
            });
            
            closeMenuButton.addEventListener('click', function() {
                mobileMenu.classList.remove('menu-open');
                mobileMenu.classList.add('menu-closed');
            });
            
            // Vendor Panel Functionality
            const vendorToggle = document.getElementById('vendor-toggle');
            const vendorPanel = document.getElementById('vendor-panel');
            const closeVendorPanel = document.getElementById('close-vendor-panel');
            
            vendorToggle.addEventListener('click', function() {
                vendorPanel.classList.toggle('open');
            });
            
            closeVendorPanel.addEventListener('click', function() {
                vendorPanel.classList.remove('open');
            });
            
            // Order Management
            const orders = JSON.parse(localStorage.getItem('abbasDelightOrders')) || [];
            const cart = [];
            const orderSummary = document.getElementById('order-summary');
            const orderTotal = document.getElementById('order-total');
            const completeOrderButton = document.getElementById('complete-order');
            const orderConfirmation = document.getElementById('order-confirmation');
            const closeConfirmation = document.getElementById('close-confirmation');
            const confirmedOrderId = document.getElementById('confirmed-order-id');
            
            // Vendor elements
            const vendorOrdersList = document.getElementById('vendor-orders-list');
            const vendorOrderDetails = document.getElementById('vendor-order-details');
            const vendorOrderContent = document.getElementById('vendor-order-content');
            const vendorUpdateStatus = document.getElementById('vendor-update-status');
            const vendorOrderStatus = document.getElementById('vendor-order-status');
            const vendorSendEmail = document.getElementById('vendor-send-email');
            const vendorSendWhatsapp = document.getElementById('vendor-send-whatsapp');
            const vendorCustomMessage = document.getElementById('vendor-custom-message');
            const vendorMessageHistory = document.getElementById('vendor-message-history');
            const messageTemplates = document.querySelectorAll('.message-template');
            
            // Stats elements
            const vendorTodayOrders = document.getElementById('vendor-today-orders');
            const vendorPendingOrders = document.getElementById('vendor-pending-orders');
            
            // Initialize vendor dashboard
            updateVendorStats();
            displayVendorOrders();
            
            // Check backend connection
            async function checkBackendConnection() {
                try {
                    const response = await fetch('http://localhost:3000/health');
                    if (response.ok) {
                        const statusElement = document.getElementById('backend-status');
                        statusElement.textContent = '✅ Backend Connected - Full Functionality Available';
                        statusElement.className = 'backend-status connected';
                    }
                } catch (error) {
                    console.log('Backend not available, using local storage');
                }
            }
            
            // Message template selection
            let selectedTemplate = null;
            messageTemplates.forEach(template => {
                template.addEventListener('click', function() {
                    // Remove active class from all templates
                    messageTemplates.forEach(t => t.classList.remove('active'));
                    // Add active class to clicked template
                    this.classList.add('active');
                    selectedTemplate = this.dataset.template;
                    
                    // Set the custom message based on template
                    const orderId = vendorUpdateStatus.dataset.orderId || '[OrderID]';
                    const customerName = document.getElementById('vendor-order-content')?.textContent.includes('Customer:') 
                        ? document.getElementById('vendor-order-content').textContent.split('Customer:')[1]?.split('\n')[0]?.trim() || '[Customer]'
                        : '[Customer]';
                    
                    let message = '';
                    switch(selectedTemplate) {
                        case 'order-confirmed':
                            message = `Hi ${customerName}, your order #${orderId} has been confirmed and is being prepared. We'll notify you when it's ready. Thank you for choosing Abba's Delight!`;
                            break;
                        case 'order-ready':
                            message = `Hi ${customerName}, your order #${orderId} is ready for pickup/delivery. Please let us know your preferred method.`;
                            break;
                        case 'delivery-update':
                            const deliveryTime = new Date();
                            deliveryTime.setHours(deliveryTime.getHours() + 1);
                            message = `Hi ${customerName}, your order #${orderId} is on its way. Estimated delivery time: ${deliveryTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}.`;
                            break;
                    }
                    
                    vendorCustomMessage.value = message;
                });
            });
            
            // Add to cart buttons
            // Improved behavior: detect price and quantity from the specific option row (so "4 pcs" and "1 pc" add correct amounts)
            const addToCartButtons = document.querySelectorAll('.add-to-cart');
            addToCartButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const itemElement = this.closest('.cart-item');
                    const id = itemElement.getAttribute('data-id');
                    const name = itemElement.getAttribute('data-name');

                    // Look for option-level info (the button sits inside the option container)
                    const optionContainer = this.parentElement;

                    // Prefer explicit data attributes on the option-row for price and qty when available
                    const dataPrice = optionContainer.dataset.optionPrice;
                    const dataQty = optionContainer.dataset.optionQty;

                    const price = parseFloat(dataPrice) || parseFloat(itemElement.getAttribute('data-price')) || 0;

                    // Determine quantity/pack/weight from data attribute (if present) or fall back to DOM parsing
                    let parsedNumber = null;
                    let parsedLabel = null; // keeps weight labels like '100g'
                    if (dataQty) {
                        parsedLabel = dataQty;
                        const num = parseFloat(String(dataQty).replace(/[^0-9.,]/g, '').replace(',', '.'));
                        if (!isNaN(num)) parsedNumber = num;
                    } else {
                        const unitLabel = optionContainer.querySelector('.text-sm')?.textContent || '';
                        const qtyMatch = unitLabel.match(/(\d+(?:[\.,]\d+)?)/);
                        if (qtyMatch) {
                            parsedNumber = parseFloat(qtyMatch[1].replace(',', '.')) || null;
                            parsedLabel = unitLabel.trim();
                        }
                    }

                    // Determine unit (pc, pack, g, etc.) from item-level attribute or label
                    let unit = itemElement.getAttribute('data-unit') || 'pc';
                    const labelForUnit = parsedLabel || optionContainer.querySelector('.text-sm')?.textContent || '';
                    if (/pack|packs/i.test(labelForUnit)) unit = 'pack';
                    else if (/g\b|gram|kg/i.test(labelForUnit)) unit = 'g';
                    else if (/pc|pcs|piece|pieces/i.test(labelForUnit)) unit = 'pc';

                    // If this option represents multiple pieces (e.g., "4 pcs – 11₽"), the displayed price
                    // is the pack price. We'll store packSize and keep quantity as number of packs (default 1).
                    let packSize = null;
                    let quantityToAdd = 1;
                    if (unit === 'pc' && parsedNumber && parsedNumber > 1) {
                        packSize = parsedNumber; // e.g., 4
                        quantityToAdd = 1; // one pack
                    } else if (unit === 'g' && parsedLabel) {
                        // weight-based item: treat as single unit with label preserved
                        quantityToAdd = 1;
                    } else {
                        // single items or numeric qtys
                        quantityToAdd = parsedNumber || 1;
                    }

                    // Consider different variants (single vs pack) separate cart lines. Include packSize in comparison.
                    const existingItemIndex = cart.findIndex(item => item.id === id && item.price === price && item.unit === unit && (item.packSize || null) === packSize);

                    if (existingItemIndex >= 0) {
                        cart[existingItemIndex].quantity += quantityToAdd;
                    } else {
                        cart.push({
                            id,
                            name,
                            price,
                            unit,
                            quantity: quantityToAdd,
                            packSize
                        });
                    }

                    updateOrderSummary();
                });
            });
            
            // Update order summary
            function updateOrderSummary() {
                if (cart.length === 0) {
                    orderSummary.innerHTML = '<p class="text-center text-gray-500 py-4">Your cart is empty</p>';
                    orderTotal.textContent = '0.00₽';
                    completeOrderButton.disabled = true;
                    completeOrderButton.classList.add('opacity-50', 'cursor-not-allowed');
                    return;
                }
                
                let summaryHTML = '';
                let total = 0;
                
                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;

                    // Friendly unit label and display for packs
                    let displayLabel = '';
                    if (item.packSize) {
                        // e.g., "1 x 4 pcs" meaning 1 pack of 4 pieces
                        displayLabel = `${item.quantity} x ${item.packSize} pcs`;
                    } else {
                        const unitLabel = item.unit === 'pc' ? 'pc' : item.unit === 'pack' ? 'pack' : item.unit;
                        displayLabel = `${item.quantity} ${unitLabel}`;
                    }

                    summaryHTML += `
                        <div class="order-summary-item flex justify-between items-center">
                            <div>
                                <p class="font-medium">${item.name} (${displayLabel})</p>
                                <button class="remove-item text-sm text-amber-600 hover:text-amber-800" data-id="${item.id}" data-price="${item.price}" data-pack="${item.packSize || ''}">
                                    Remove
                                </button>
                            </div>
                            <p>${itemTotal.toFixed(2)}₽</p>
                        </div>
                    `;
                });
                
                orderSummary.innerHTML = summaryHTML;
                orderTotal.textContent = `${total.toFixed(2)}₽`;
                
                completeOrderButton.disabled = false;
                completeOrderButton.classList.remove('opacity-50', 'cursor-not-allowed');
                
                // Add event listeners to remove buttons
                const removeButtons = document.querySelectorAll('.remove-item');
                removeButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const itemId = this.getAttribute('data-id');
                        const itemPrice = parseFloat(this.getAttribute('data-price')) || null;
                        const packAttr = this.getAttribute('data-pack');
                        const packSize = packAttr ? parseFloat(packAttr) : null;

                        const itemIndex = cart.findIndex(item => item.id === itemId && (itemPrice === null || item.price === itemPrice) && ((item.packSize || null) === packSize));

                        if (itemIndex >= 0) {
                            cart.splice(itemIndex, 1);
                            updateOrderSummary();
                        }
                    });
                });
            }
            
            // Complete order button
            completeOrderButton.addEventListener('click', async function() {
                const form = document.getElementById('order-form');
                const customerName = document.getElementById('customer-name').value;
                const customerPhone = document.getElementById('customer-phone').value;
                const customerEmail = document.getElementById('customer-email').value;
                const customerAddress = document.getElementById('customer-address').value;
                const deliveryTime = document.getElementById('delivery-time').value;
                const specialInstructions = document.getElementById('special-instructions').value;
                
                // Simple form validation
                let isValid = true;
                form.querySelectorAll('input[required], textarea[required]').forEach(input => {
                    if (!input.value.trim()) {
                        isValid = false;
                        input.classList.add('border-red-500');
                    } else {
                        input.classList.remove('border-red-500');
                    }
                });
                
                if (!isValid) {
                    alert('Please fill in all required fields.');
                    return;
                }
                
                if (cart.length === 0) {
                    alert('Your cart is empty. Please add items before ordering.');
                    return;
                }
                
                // Try to submit to backend first
                const orderData = {
                    customerName,
                    customerPhone,
                    customerEmail,
                    customerAddress,
                    deliveryTime,
                    specialInstructions,
                    items: cart
                };
                
                let orderSubmitted = false;
                    let createdOrderId = null;
                    let finalOrder = null; // will hold the order object (backend or local) used to build the WhatsApp message
                
                try {
                    const response = await fetch('http://localhost:3000/api/orders', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(orderData)
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        if (result.success) {
                            orderSubmitted = true;
                            // Prefer returned order id from backend
                            createdOrderId = result.data?.orderId || result.data?.order?.id || null;
                            console.log('Order submitted to backend:', createdOrderId || result.data);

                            // If backend returned a full order payload, keep local copy up-to-date and use it as finalOrder
                            if (result.data?.order) {
                                finalOrder = result.data.order;
                                orders.unshift(result.data.order);
                                localStorage.setItem('abbasDelightOrders', JSON.stringify(orders));
                            } else {
                                // If backend returned minimal info, populate a small finalOrder to use for the WhatsApp message
                                finalOrder = {
                                    id: createdOrderId || ('AD' + Date.now()),
                                    customerName: orderData.customerName,
                                    customerPhone: orderData.customerPhone,
                                    customerEmail: orderData.customerEmail,
                                    customerAddress: orderData.customerAddress,
                                    deliveryTime: orderData.deliveryTime,
                                    specialInstructions: orderData.specialInstructions,
                                    items: orderData.items,
                                    total: parseFloat(orderTotal.textContent.replace(/[^0-9.-]+/g, '')) || 0,
                                    status: 'new',
                                    timestamp: new Date().toISOString(),
                                    messages: []
                                };
                            }
                        }
                    }
                } catch (error) {
                    console.log('Backend not available, using local storage');
                }
                
                // If backend submission failed, use local storage
                if (!orderSubmitted) {
                    // Create order object
                    const totalValue = parseFloat(orderTotal.textContent.replace(/[^0-9.-]+/g, '')) || 0;
                    const order = {
                        id: 'AD' + Date.now(),
                        customerName,
                        customerPhone,
                        customerEmail,
                        customerAddress,
                        deliveryTime,
                        specialInstructions,
                        items: [...cart],
                        total: totalValue,
                        status: 'new',
                        timestamp: new Date().toISOString(),
                        messages: []
                    };
                    
                    // Add to orders
                    orders.unshift(order);
                    localStorage.setItem('abbasDelightOrders', JSON.stringify(orders));
                    
                    // Update vendor dashboard
                    updateVendorStats();
                    displayVendorOrders();
                    createdOrderId = order.id;
                    finalOrder = order; // use fallback order as finalOrder
                }
                
                // Show confirmation
                // Prefer createdOrderId (from backend or local fallback). If not available, fall back to customer name.
                confirmedOrderId.textContent = createdOrderId || orderData.customerName || 'N/A';
                orderConfirmation.classList.remove('hidden');

                // Build WhatsApp message link (business number must be in international format without +/- or spaces)
                try {
                    const businessNumber = '375255266598';
                    if (finalOrder) {
                        const lines = [];
                        lines.push('New order from Abba\'s Delight');
                        lines.push(`Order ID: ${finalOrder.id}`);
                        lines.push(`Customer: ${finalOrder.customerName}`);
                        lines.push(`Phone: ${finalOrder.customerPhone}`);
                        lines.push(`Address: ${finalOrder.customerAddress}`);
                        if (finalOrder.deliveryTime) lines.push(`Delivery: ${new Date(finalOrder.deliveryTime).toLocaleString()}`);
                        lines.push('Items:');
                        finalOrder.items.forEach(item => {
                            let qtyLabel = '';
                            if (item.packSize) qtyLabel = `${item.quantity} x ${item.packSize} pcs`;
                            else if (item.unit === 'g') qtyLabel = `${item.quantity}g`;
                            else qtyLabel = `${item.quantity} ${item.unit || 'pc'}`;
                            lines.push(`- ${qtyLabel} ${item.name} - ${(item.price * item.quantity).toFixed(2)}₽`);
                        });
                        lines.push(`Total: ${ (finalOrder.total || (parseFloat(orderTotal.textContent.replace(/[^0-9.-]+/g, '')) || 0)).toFixed(2) }₽`);
                        if (finalOrder.specialInstructions) lines.push(`Instructions: ${finalOrder.specialInstructions}`);
                        lines.push('Thank you!');

                        const message = lines.join('\n');
                        const waLink = `https://wa.me/${businessNumber}?text=${encodeURIComponent(message)}`;
                        const waAnchor = document.getElementById('send-order-whatsapp');
                        if (waAnchor) {
                            waAnchor.href = waLink;
                        }
                    }
                } catch (e) {
                    console.error('Failed to build WhatsApp link for order:', e);
                }

                // Reset cart and form
                cart.length = 0;
                updateOrderSummary();
                form.reset();
            });
            
            // Close confirmation modal
            closeConfirmation.addEventListener('click', function() {
                orderConfirmation.classList.add('hidden');
            });
            
            // Vendor functionality
            function updateVendorStats() {
                const today = new Date().toDateString();
                const todayOrders = orders.filter(order => new Date(order.createdAt || order.timestamp).toDateString() === today);
                const pendingOrders = orders.filter(order => order.status !== 'completed').length;
                
                vendorTodayOrders.textContent = todayOrders.length;
                vendorPendingOrders.textContent = pendingOrders;
            }
            
            function displayVendorOrders() {
                if (orders.length === 0) {
                    vendorOrdersList.innerHTML = '<p class="text-center text-gray-500 py-4">No orders yet</p>';
                    return;
                }
                
                vendorOrdersList.innerHTML = '';
                
                orders.forEach(order => {
                    const orderElement = document.createElement('div');
                    orderElement.className = 'bg-amber-50 p-3 rounded-lg cursor-pointer hover:bg-amber-100 transition';
                    orderElement.innerHTML = `
                        <div class="flex justify-between items-center mb-1">
                            <h4 class="font-bold">${order.id}</h4>
                            <span class="text-xs ${getStatusClass(order.status)} px-2 py-1 rounded-full">${order.status}</span>
                        </div>
                        <p class="text-sm">${order.customerName}</p>
                        <p class="text-sm">${order.total.toFixed(2)}₽</p>
                        <p class="text-xs text-gray-500">${new Date(order.createdAt || order.timestamp).toLocaleString()}</p>
                    `;
                    
                    orderElement.addEventListener('click', function() {
                        showVendorOrderDetails(order);
                    });
                    
                    vendorOrdersList.appendChild(orderElement);
                });
            }
            
            function showVendorOrderDetails(order) {
                vendorOrderContent.innerHTML = `
                    <p><strong>Order ID:</strong> ${order.id}</p>
                    <p><strong>Customer:</strong> ${order.customerName}</p>
                    <p><strong>Phone:</strong> ${order.customerPhone}</p>
                    <p><strong>Email:</strong> ${order.customerEmail}</p>
                    <p><strong>Address:</strong> ${order.customerAddress}</p>
                    <p><strong>Delivery:</strong> ${new Date(order.deliveryTime).toLocaleString()}</p>
                    <p><strong>Status:</strong> <span class="${getStatusClass(order.status)} px-2 py-1 rounded-full">${order.status}</span></p>
                    
                    <div class="mt-3">
                        <strong>Items:</strong>
                        <ul class="list-disc list-inside mt-1">
                            ${order.items.map(item => {
                                const name = item.name;
                                let qtyLabel = '';
                                if (item.packSize) {
                                    qtyLabel = `${item.quantity} x ${item.packSize} pcs`;
                                } else if (item.unit === 'g' && item.quantity) {
                                    qtyLabel = `${item.quantity}g`;
                                } else {
                                    qtyLabel = `${item.quantity} ${item.unit || 'pc'}`;
                                }
                                return `<li>${qtyLabel} ${name} - ${(item.quantity * item.price).toFixed(2)}₽</li>`;
                            }).join('')}
                        </ul>
                    </div>
                    
                    <p class="mt-3"><strong>Total:</strong> ${order.total.toFixed(2)}₽</p>
                    <p class="mt-1"><strong>Instructions:</strong> ${order.specialInstructions || 'None'}</p>
                `;
                
                vendorOrderStatus.value = order.status;
                vendorOrderDetails.classList.remove('hidden');
                
                // Store current order ID for update
                vendorUpdateStatus.dataset.orderId = order.id;
                vendorSendEmail.dataset.orderEmail = order.customerEmail;
                vendorSendWhatsapp.dataset.orderPhone = order.customerPhone;
                
                // Reset message templates
                messageTemplates.forEach(t => t.classList.remove('active'));
                selectedTemplate = null;
                vendorCustomMessage.value = '';
                
                // Display message history
                displayMessageHistory(order);
            }
            
            function displayMessageHistory(order) {
                vendorMessageHistory.innerHTML = '';
                
                if (!order.messages || order.messages.length === 0) {
                    vendorMessageHistory.innerHTML = '<p class="text-center text-gray-500 py-4">No messages sent yet</p>';
                    return;
                }
                
                order.messages.forEach(message => {
                    const messageElement = document.createElement('div');
                    messageElement.className = 'customer-message';
                    messageElement.innerHTML = `
                        <p class="text-sm font-medium">${message.type} - ${new Date(message.timestamp).toLocaleString()}</p>
                        <p class="text-sm mt-1">${message.content}</p>
                    `;
                    vendorMessageHistory.appendChild(messageElement);
                });
            }
            
            function getStatusClass(status) {
                switch(status) {
                    case 'new': return 'order-status-new';
                    case 'preparing': return 'order-status-preparing';
                    case 'ready': return 'order-status-ready';
                    case 'completed': return 'order-status-completed';
                    default: return 'order-status-new';
                }
            }
            
            // Update order status
            vendorUpdateStatus.addEventListener('click', async function() {
                const orderId = this.dataset.orderId;
                const newStatus = vendorOrderStatus.value;
                const message = vendorCustomMessage.value;
                
                if (!orderId) return;
                
                // Try to update via backend first
                try {
                    const response = await fetch(`http://localhost:3000/api/vendor/orders/${orderId}/status`, {
                        method: 'PATCH',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ status: newStatus, message })
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        if (result.success) {
                            // Update local order
                            const orderIndex = orders.findIndex(o => o.id === orderId);
                            if (orderIndex !== -1) {
                                orders[orderIndex] = result.data.order;
                            }
                        }
                    }
                } catch (error) {
                    console.log('Backend not available, using local storage');
                    
                    // Fallback to local storage
                    const orderIndex = orders.findIndex(o => o.id === orderId);
                    if (orderIndex !== -1) {
                        orders[orderIndex].status = newStatus;
                        orders[orderIndex].updatedAt = new Date().toISOString();
                        
                        if (message) {
                            if (!orders[orderIndex].messages) {
                                orders[orderIndex].messages = [];
                            }
                            orders[orderIndex].messages.push({
                                id: Date.now().toString(),
                                type: 'status_update',
                                content: message,
                                timestamp: new Date().toISOString()
                            });
                        }
                        
                        localStorage.setItem('abbasDelightOrders', JSON.stringify(orders));
                    }
                }
                
                // Update display
                displayVendorOrders();
                updateVendorStats();
                alert(`Order status updated to ${newStatus}`);
            });
            
            // Send email to customer
            vendorSendEmail.addEventListener('click', function() {
                const customerEmail = this.dataset.orderEmail;
                const message = vendorCustomMessage.value || "Thank you for your order from Abba's Delight!";
                const orderId = vendorUpdateStatus.dataset.orderId;
                
                if (!customerEmail) {
                    alert('No customer email available for this order.');
                    return;
                }
                
                if (!message.trim()) {
                    alert('Please enter a message to send.');
                    return;
                }
                
                // Record the message for reference
                recordCustomerMessage(orderId, 'Email', message);
                
                // Create mailto link
                const mailtoLink = `mailto:${customerEmail}?subject=Update on your order #${orderId}&body=${encodeURIComponent(message)}`;
                window.open(mailtoLink, '_blank');
                
                alert(`Email ready to be sent to: ${customerEmail}`);
            });
            
            // Send WhatsApp message to customer
            vendorSendWhatsapp.addEventListener('click', function() {
                const customerPhone = this.dataset.orderPhone;
                const message = vendorCustomMessage.value || "Thank you for your order from Abba's Delight!";
                const orderId = vendorUpdateStatus.dataset.orderId;
                
                if (!customerPhone) {
                    alert('No customer phone number available for this order.');
                    return;
                }
                
                if (!message.trim()) {
                    alert('Please enter a message to send.');
                    return;
                }
                
                // Record the message for reference
                recordCustomerMessage(orderId, 'WhatsApp', message);
                
                // Format phone number (remove any non-digit characters)
                const formattedPhone = customerPhone.replace(/\D/g, '');
                
                // Create WhatsApp link
                const whatsappLink = `https://wa.me/${formattedPhone}?text=${encodeURIComponent(message)}`;
                window.open(whatsappLink, '_blank');
                
                alert(`WhatsApp message ready to be sent to: ${customerPhone}`);
            });
            
            // Record customer message for reference
            function recordCustomerMessage(orderId, type, content) {
                const orderIndex = orders.findIndex(order => order.id === orderId);
                if (orderIndex !== -1) {
                    if (!orders[orderIndex].messages) {
                        orders[orderIndex].messages = [];
                    }
                    
                    orders[orderIndex].messages.push({
                        id: Date.now().toString(),
                        type: type,
                        content: content,
                        timestamp: new Date().toISOString()
                    });
                    
                    localStorage.setItem('abbasDelightOrders', JSON.stringify(orders));
                    
                    // Update message history display
                    if (vendorUpdateStatus.dataset.orderId === orderId) {
                        displayMessageHistory(orders[orderIndex]);
                    }
                }
            }
        });
    </script>
</body>
</html>
